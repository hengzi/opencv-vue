(function(e){function t(t){for(var s,n,r=t[0],c=t[1],d=t[2],h=0,u=[];h<r.length;h++)n=r[h],a[n]&&u.push(a[n][0]),a[n]=0;for(s in c)Object.prototype.hasOwnProperty.call(c,s)&&(e[s]=c[s]);l&&l(t);while(u.length)u.shift()();return o.push.apply(o,d||[]),i()}function i(){for(var e,t=0;t<o.length;t++){for(var i=o[t],s=!0,r=1;r<i.length;r++){var c=i[r];0!==a[c]&&(s=!1)}s&&(o.splice(t--,1),e=n(n.s=i[0]))}return e}var s={},a={app:0},o=[];function n(t){if(s[t])return s[t].exports;var i=s[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=s,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/opencv-vue/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var d=0;d<r.length;d++)t(r[d]);var l=c;o.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},"56d7":function(e,t,i){"use strict";i.r(t);i("cadf"),i("551c"),i("f751"),i("097d");var s=i("2b0e"),a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"app",attrs:{id:"app"}},[i("div",{staticClass:"webcam"},[i("video",{ref:"videoSrc",staticClass:"webcam-video",attrs:{width:e.videoWidth,height:e.videoHeight},on:{canplay:e.onSourceReady}},[e._v("Your browser does not support this application.")]),i("canvas",{ref:"canvas",staticClass:"webcam-canvas",attrs:{width:e.videoWidth,height:e.videoHeight}})])])},o=[],n=i("3191"),r=i.n(n),c=i("294d"),d=i.n(c),l="/opencv-vue/",h=null,u={name:"app",data:function(){return{videoWidth:1920,videoHeight:1080,stream:null,stats:null,canvasCtx:null,faceClassifier:null,detectMat:null,videoCap:null,faceVect:null,processTimer:null}},methods:{startCamera:function(){var e=this,t={audio:!1,video:{width:{facingMode:"user",min:960,ideal:1280,max:1920},height:{min:540,ideal:720,max:1080}}};d()(t,function(t,i){t?console.warn("getUserMedia failed",t):(console.log("startCamera"),e.stream=i,e.$refs.videoSrc.srcObject=i,e.$refs.videoSrc.play())})},stopCamera:function(){console.log("stopCamera"),this.stream&&(this.stopVideoProcessing(),this.$refs.videoSrc.pause(),this.$refs.videoSrc.srcObject=null,this.stream.getVideoTracks()[0].stop(),this.stream=null)},onSourceReady:function(){this.videoWidth=this.$refs.videoSrc.videoWidth,this.videoHeight=this.$refs.videoSrc.videoHeight,console.log("onSourceReady:",this.videoWidth,this.videoHeight),window.Module?(h=window.Module,this.startVideoProcessing()):this.loadOpenCv()},initStats:function(){this.stats=new r.a,this.stats.showPanel(0),this.$refs.app.appendChild(this.stats.dom)},loadOpenCv:function(){var e=this;if(window.WebAssembly){var t=document.createElement("script");t.type="text/javascript",t.async="async",t.src="".concat(l,"libs/opencv.js"),document.body.appendChild(t),t.onload=function(){console.log("OpenCV.js is loaded")},window.Module={wasmBinaryFile:"".concat(l,"libs/opencv_js.wasm"),preRun:function(){console.log("loading haarcascade_frontalface_default.xml"),window.Module.FS_createPreloadedFile("/","haarcascade_frontalface","".concat(l,"data/haarcascade_frontalface_default.xml"),!0,!1)},_main:function(){console.log("OpenCV.js is ready"),h=window.cv,e.startVideoProcessing()}}}else console.warn("Your web browser doesn't support WebAssembly.")},startVideoProcessing:function(){this.stream?(this.canvasCtx=this.$refs.canvas.getContext("2d"),this.faceClassifier=new h.CascadeClassifier,this.faceClassifier.load("haarcascade_frontalface"),this.srcMat=new h.Mat(this.videoHeight,this.videoWidth,h.CV_8UC4),this.detectMat=new h.Mat,this.videoCap=new h.VideoCapture(this.$refs.videoSrc),this.faceVect=new h.RectVector,this.initStats(),this.processTimer=requestAnimationFrame(this.processVideo)):console.warn("Please startup your webcam.")},stopVideoProcessing:function(){console.log("stopVideoProcessing"),cancelAnimationFrame(this.processTimer),this.stats.end(),this.faceClassifier&&!this.faceClassifier.isDeleted()&&this.faceClassifier.delete(),this.srcMat.delete(),this.detectMat.delete(),this.faceVect.delete(),this.canvasCtx.clearRect(0,0,this.videoWidth,this.videoHeight)},processVideo:function(){this.$refs.videoSrc?(this.stats.begin(),this.videoCap.read(this.srcMat),h.cvtColor(this.srcMat,this.detectMat,h.COLOR_RGBA2GRAY,0),h.pyrDown(this.detectMat,this.detectMat),h.pyrDown(this.detectMat,this.detectMat),this.faceClassifier.detectMultiScale(this.detectMat,this.faceVect,1.1,3,0),this.drawFace(),this.stats.end(),this.processTimer=requestAnimationFrame(this.processVideo)):console.warn("Video stream not found.")},drawFace:function(){this.canvasCtx.clearRect(0,0,this.videoWidth,this.videoHeight),console.log(this.faceVect.size());for(var e=0;e<this.faceVect.size();++e){var t=this.faceVect.get(e);t.width>0&&t.height>0&&(this.canvasCtx.lineWidth=2,this.canvasCtx.strokeStyle="red",this.canvasCtx.strokeRect(4*t.x,4*t.y,4*t.width,4*t.height))}}},mounted:function(){this.startCamera()},beforeDestroy:function(){this.stopCamera()}},f=u,p=(i("7c55"),i("2877")),v=Object(p["a"])(f,a,o,!1,null,null,null),m=v.exports;i("b059");s["a"].config.productionTip=!1,new s["a"]({render:function(e){return e(m)}}).$mount("#app")},"5c48":function(e,t,i){},"7c55":function(e,t,i){"use strict";var s=i("5c48"),a=i.n(s);a.a},b059:function(e,t,i){}});
//# sourceMappingURL=app.9091bed9.js.map